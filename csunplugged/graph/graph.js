//set main namespace
goog.provide('cs.graph');

//======================================================
// graph.js 2018.02.15
// by TPET gsyan  https://gsyan888.blogspot.com/ 
// 
// Change log :
//	2018.02.25 first release
//	2018.02.26 JSON fomat export & import 
//	2018.02.27 canvas text wordwrap (export to PNG),
//			   add new options: cfg_nodeObjectDefaultColor, cfg_lineDefaultColor 
//	2018.02.28 Android/iOS import function
//	2023.06.07 mirror the label of line by the rotation of line
//			   popupMenu add resize options to change size.
//			   line popupMenu press arrow can set arrow or change the direction
//	2023.06.08 export/import include nodes size
//======================================================

//get requirements
goog.require('lime.Director');
goog.require('lime.Scene');
goog.require('lime.Layer');
goog.require('lime.Circle');
goog.require('lime.RoundedRect');
goog.require('lime.Polygon');
goog.require('lime.Label');
goog.require('lime.CanvasContext');
goog.require('lime.animation.Spawn');
goog.require('lime.animation.FadeTo');
goog.require('lime.animation.ScaleTo');
goog.require('lime.animation.MoveTo');

goog.require('lime.Button');

goog.require('game.Util');
goog.require('game.Input');
goog.require('game.Button');
goog.require('game.Util.Data');

//iPad Portrait: 768x946  (748x1024)
//iPad Landscape: 1024x690  (768x1004)

//576x749

cs.graph.Width = 1024;
cs.graph.Height = 748; //576; //768;

cs.graph.config_file = 'graph_conf.js';

cs.graph.nodeObjectDefaultColor = '#00CC00'; //節點新增時預設的顏色
cs.graph.lineDefaultColor = '#000000';		//連接線新增時預設的顏色

cs.graph.defaultNodeObjectSize = 100;	//節點的預設大小
cs.graph.defaultLineSize = 10;	//連線的預設粗細
cs.graph.defaultLongpressTime = 500; //預設按下多久為長按

cs.graph.colors = new Array(
	  '#000000'
	, '#FF0000'
	, '#00CC00'
	, '#0000FF'
	, '#FFFF00'
	, '#00FFFF'
	, '#FF00FF'
	, '#C0C0C0'
	, '#ff8000'
);

cs.graph.clickEnabled = true;


alphaValueDisabled = 0.2;

//
//圖案, 以 base64 編碼過的 png 圖檔
//編碼工具網站:  http://www.base64-image.de
//
cs.graph.penIcon = 'data:image/png;base64,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';
cs.graph.addIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAbsAAAG7AEedTg1AAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAs1QTFRFAAAAAP8AgIAAVaoAQIAAM5kAVYAASZIAQIAAOY4ATYAARosAQJUATokASZIARIgAQI8AS4cAR44AQ4YAQIwASZIARosAQ5AASooAR48ARYkAQo4ASYkARo0ARIgASowASI8ARosARI8ASYoAR44ARYoAQ40ASIkAR44ASIsAR40ARYoARI0AR4oARowARY4ASIwAR44ARosASIsARYoARIwAR4oARowASIsAR40ARosARY0AR4sARowARYoARowAR4sARo0ARosAR4sARowARYsAR40ARowARY0AR4sAR4wAR40ARowAR4sARo0ARosARYwARowARY0ARo0ARowAR4sARowARosARYwAR4sARowARY0AR4wARo0ARosARYwAR4sARosARYwARo0ARowARY0AR4wARo0ARosARYwAR4sARowARosAR4wARo0ARowARY0AR4wARowARosAR4sARowARo0AR4wARo0ARowARY0AR4wARosARowAR4wARo0ARowARYwAR4wARowARosARYwARosARowARo0AR4wARowARowARYwAR4wARowARosARo0ARowARo0AR4wARowARowARYwARosARowARosARo0ARowARowAR4wARowARosARowARo0AR4wARo0ARowARowARowARowARowARYwARosARowARo0AR4wARowARowARowARowARowARowARosARowARowAR4wARowARowARowARowARowARowARYwARo0ARowARowARowARowARowARowARowARosAR4wARowARowARowARowARowARowARowARowARowARo0ARowARowARowARowARowARowARowATJAIUJIOXJoeXJofYZ0lYp4nZqAsaaIwfK1KhLJVj7lksc6Tvtalx9yyzuG85O7a5vDd6fHg7PPl9vny////rv/h5gAAANl0Uk5TAAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJysuLzAxMjM0NTY3OTs8PT5A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';
cs.graph.eraserIcon = 'data:image/png;base64,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';
cs.graph.textIcon = 'data:image/png;base64,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';
cs.graph.arrowIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAbdEVYdFRpdGxlAGZ0bGluZSBsaW5lIGFycm93IGVuZICq9+sAAAAQdEVYdEF1dGhvcgBBbm9ueW1vdXMhBHR/AAAAYHRFWHREZXNjcmlwdGlvbgBPcmlnaW5hbGx5IHVwbG9hZGVkIGJ5IERhbm55IEFsbGVuIGZvciBPQ0FMIDAuMTggdGhpcyBpY29uIGlzIHBhcnQgb2YgdGhlIGZsYXQgdGhlbWWnIz28AAAAIXRFWHRDcmVhdGlvbiBUaW1lADIwMTEtMDEtMzFUMDI6MDE6NDPrsdAnAAAAT3RFWHRTb3VyY2UAaHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzExMzE5MS9mdGxpbmUtbGluZS1hcnJvdy1lbmQtYnktYW5vbnltb3VzTuA6DQAAAFh0RVh0Q29weXJpZ2h0AENDMCBQdWJsaWMgRG9tYWluIERlZGljYXRpb24gaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvcHVibGljZG9tYWluL3plcm8vMS4wL8bjvfkAAANTSURBVGiB7do7axxXFMDx/5lrFBSsqDEhsUJMYiwkbSWtGEhwkYRUadx4SZcq38KG+AMYu3dlSJMmpHaTiIAgeEeaauUEbSE3Kxm/CJtCsZh7Ujgyq/XManZ3HncGne6ePffx47B3YWbhLOodUvYBsopms/kxsCQiDeCytfapqt4Pw/DxYF3VwJ7v+5eiKFpR1RXP85ZVtQEsAe/F1PdF5OsgCB4eJ84VdtQxotVqmd3d3U+NMQ1gWURWVHUFWIqi6F0AEUFVT1tqTlXvAFePE6V3eHV19aIx5nNVXRaRhqou8bpj72S0xautra03a5Xa4bW1tR9E5KaqngPSdGyS6A8OSgOvr69/o6q3Cthqf3DgFbBhUlwraJ/e4KA0sLX2VUFbudFhz/N+BKKU5Y+BB8AdEbkpIs/G2OpEh0v7DgdB8LDZbH4H3AXeByywB+yo6g7wyBjTmZmZ+XNzc7MP4Pv+YhRFvwEXxtjqRIdL/1lqtVqm2+1+ND8//2RjY+MwqW4Ae3Gc9UXkehAEP78ZT3HWwmJSLICqfra9vf3H8bjMWzpVpMT+nfSBqrpxaaWJlNgnqnov4TPt9/sHgwlnwWmx1tqvRCTJ8bzb7f47mHASPA42DMOdEXW94YRz4AmwAB/GFYmI2+AJsYyo3x9OOAOeAkvSHGutmx2eBttoNM4D5xPmuNfhKTvL7Ozswoh5bnV4WiyAqo6a606Hs8D+H7E3NDh0S2eIBfggIa+Hh4cHw8nCwRljEZG4x7MAzzudzlsPGQoFZ40FUNVOQr4dly8MnAcWYG5u7hcR+X0o/Y/neTfi6k3ahaeJvLAAe3t7dnFx8aejo6MXqvpSRH41xnzfbrdjO5/7A4A8sZNErmDXsJAj2EUs5AR2FQs5gF3GQsZg17GQIbgKWMgIXBUsZACuEhamBFcNC1OAq4iFCcFVxcIE4CpjYUxw1bEwBrgOWEgJrgsWUoDrhIVTwHXDwghwHbGQAK4rFmLAdcbC0P+0fN//JIqiDUa8vgD2ReTLMAz/yvVkOcWJ59LW2tukwAZBUEksDIFV9YsRtZXHwttvHp4m1NUCC0NgEbkbU1MbLAy9aun1elsLCwsHwBVe3+APjDHfttvtbimnO4uzOIvT4j/Nt5/IrXFUawAAAABJRU5ErkJggg==';
cs.graph.lineIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAbdEVYdFRpdGxlAGZ0bGluZSBsaW5lIGFycm93IGVuZICq9+sAAAAQdEVYdEF1dGhvcgBBbm9ueW1vdXMhBHR/AAAAYHRFWHREZXNjcmlwdGlvbgBPcmlnaW5hbGx5IHVwbG9hZGVkIGJ5IERhbm55IEFsbGVuIGZvciBPQ0FMIDAuMTggdGhpcyBpY29uIGlzIHBhcnQgb2YgdGhlIGZsYXQgdGhlbWWnIz28AAAAIXRFWHRDcmVhdGlvbiBUaW1lADIwMTEtMDEtMzFUMDI6MDE6NDPrsdAnAAAAT3RFWHRTb3VyY2UAaHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzExMzE5MS9mdGxpbmUtbGluZS1hcnJvdy1lbmQtYnktYW5vbnltb3VzTuA6DQAAAFh0RVh0Q29weXJpZ2h0AENDMCBQdWJsaWMgRG9tYWluIERlZGljYXRpb24gaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvcHVibGljZG9tYWluL3plcm8vMS4wL8bjvfkAAAHYSURBVGiB7dqtTgNBFIbhd7oWg2xVVWs3ZFNJ+AmXwE0guA4UCYSbQZAm1DZTR0CgJwTBDdBdBIiybbfbdmZnzmQ/eeaI7zGjDrRp00ZylO8CtpKmaT9JkgfgAvgqiuJea30D5It7iZd2lpNl2VApNQGO+DUdKKXOe73etzHmeXG346WhxWRZNiyKYgx0VzxflQeiwRuwAIflgVhwDSzAU3kgElwTazqdznV5KO6XHo1Gg/l8PgZ6FWsfeZ6fzWazl/KDKPC+WBAEtoEFIWBbWBAAtomFwMG2sRAw2AUWAgW7wkKAYJdYCAzsGgsBgZvAQiDgprAQALhJLHgGN40Fj2AfWPAE9oUFD2CfWGgY7BsLDYJDwEJD4FCw0AA4JCw4BoeGBYfgELHgCBwqFhyAQ8aCZXDoWLAIloAFS2ApWLAAloSFPcHSsLAHWCIWdgRLxcIOYMlY2BIsHQtbgGPAQk1wLFioAY4JCxvAsWGhAhwjFtaAY8XCCnDMWChd06Zp2gcmVGONUupEa/3qspir/Ds9TJLklg3nfEqp0+l0+ua2lruUby2PK3bFY2EZ/LlmLwosLIPvVuxEg4XSp2WMmXa7XaOUGvyNHvM8v9Rav3vo1qZNm835AQLrOFQFoxD6AAAAAElFTkSuQmCC';
cs.graph.downloadIcon = 'data:image/png;base64,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';
cs.graph.saveIcon = 'data:image/png;base64,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';
cs.graph.loadIcon = 'data:image/png;base64,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';
cs.graph.exportPNGIcon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAIAAAC2BqGFAAAhW0lEQVR42uWdB2AVVbrHzzlzptybe9NJT4AEEiAUASuoC4pldcXeYHfl+XTtsriy1nXXgquooD5RUVHAJwIWnoVVpAtKkRqatBCkprfbZ+ac9525NyFAElLvZd3Pq07mzp3ym2/+5/tOG8w5R60xHgiYO3cGZs82NmzgNTWIMbGWEJKURC+4QBk5UsrJQRi3ap//CYZbDhqweh5+WF+8GH6CJQmZJsIEyVR8xRgOBAA313USG6uMGqWNG4c1LdJXdxpZS0F7nnzSP306AnbA1DR57144O5t3SUJOB5YVzkzkcqGiIrx+AzpazBWZe72Od95Rrr020hd4utipQbOSkspevUhiIjYMlJDABw3Egwcjmw0kA1OJSxTLEqcq1hSu2bDTyXfuwF/Ox6tWgZuj+PjY1auxokT6MiNvpwBt7tpVe+mlXNNAdHmvXvzccwggBumgFFHKKQWInEriT1kRMiLJyGHnskIOHOCvTMKlpeD+MXv3IpCa/2xrDjT4cs1ZZ3GbDTZC5w/l3bOBNicEyzKXZUIpE6BlROEjCdCAXpYBN4gJstsRRnjSZL5iJZSTMZs2RfpKI2zNgS6PjSUpKYLyJSNQdLQoAykgFr4MrIEysf6LAC4sKzITMgKsBXGBHu5QtBO9/Q76bJ582aWOGTMifbGRtCZBi9Lvk09EoNa/H05LE1taDktkyiSJqCoHNRDQhQtzKgvXlqx7oCjC06n1laag6Bg0fjzavsP+0kvqLbdE+nojZo2Dhkiusk8fkGOemYF65oIICIJBdxYOS4QKC+4WTcup6+5BvZhQFERv13itm4wdZ5QUJ5aXR/p6I2aNg3bddZe+ZAm223nffEsHZBFgwH8FUCj6oNyDPxVLKGSuKFhTsc3OZNiMgojDXhGWgjcAIm4eH4e+W4QnTYqaMkW58cZIX3JkrBHQ3Oerzs8HZcAZ6ahLMiIYUArNtUILLNwWhEKoBFJVEXW43fzAQVJUxL0eEVP36IEGDUTwW5AdkBfwbhUCbU6eeBJynNi1ayN9yZGxRkDrK1a4xowRuV/v3kjCImKDgo5CmCGB/wqnBuiKhuw27HLztWvxkSMIQmzYPph56zqkiOjMwej22yFfFw4OChMdTT76mM+eHVtYCLF2pK/69ABde/PNZkEBB29NB69EImITokEFa0j5wJ3tqiBbsBXt34/A2esR1xvs0+tFyUns/gdwfCzoCGgLqqxE99xnf+st9YYbIn3Vwgy//suGA9XllX6PD8MJOmwxidE4kWZ1y8KdUFfTCOiK1FQSE8Ojo3FsDCcQsRFI/ECURZisqhDSATK+bTtu6MUnG+wW3Dktjd9/L7FHMYi+ExPQ1dep/327fcKEyCI+sGX/z0u2uGo8EpVkTZFlKqmUSIRIkgYOIePk7ikZ/bNgTeeCLo+JkQCQ0ykKQ+HLQmeFO6tQEiq4sJAXF4voDRA3f+dhz34/z81F4//CXW6cGI8e+LM8ZIjjjTcihTjg8X8z+Uu/L6AqiqRRSmVJkQA3VSgIIyxIskRALRFEWFJS79S0nPROBF0BepqRAemGyLypxKgCiKEY5CC+oLCMNefIJ7OureXX34AuGc5tDjzhOblnrmPq1IhQ/mnJmqKFe4EsJxxAwzMKYE8GLYFzi1CVYIaoJvcelt9ZoMujo6WMDBG0QVZiJYGiNKt18aoqfEovPtngxjDGHrgf9+nDX3hByenpePut8FMuWV684vsl2CCi1AHQ8ilABxcAjTPBmTWgW+eADkoHhHcAGsIMQiB/EYrcBspBCwRQRgb725P42efk/HzHlClhpuxzeT//51yNasg6/ZaDhpVwxTHJsSm5aR0PujI7O1hnL+qP4H9BxGLbtpbFQqwD/IwBaNs2bfRo21NPhRn0nMc+klUJodD5twI0bANJGeMZ/bJsTlsHg3Y9+KCxaBFquL794Q7szTA4YyDQ8ogR4aT888odWxdsahhCtAo0xCRYIkAp5+yeHQzaKCioHTkSQo4Ov2ZWXR23Zw+2tcs1WmsfjZ9hg8C/ga+0HjQ8DSyjb1fF1vYWjMbqOhir6t/fahLs0Lidc5KbG/3FF+Gk7Kqonf/SFzJETQ1PpPWgJcjVbEpqXtujvcYrlbwvvOCbNk3EGx1nzOuNnjOHnn12uCAL27+paM3cH4Bjw5VtAE0ViK9JRt+sNp9JE9WkPl9VVhZKSOioZBSOwY8eja+oCCdlsEVvfldTUlFfDIZOpk2gGWfd+mWjtjbJNVnx7583z/vIIyLIazdrOAB2u50LFki9eoUZ9DeTv/JWe048nzaBhh+m5KYqNrWDQYNVDR4s6obaZ4Kyrit33GF/5JGwMrZs/stf+F2+E0/pdAPN/f7q3r1FIs552wpGsWvOaXKyc9my8FMG+/a1rz2V7g4BDaDSemecUK52DGhhpllz5pmmx4NFu0lrWHPLlxmWUpOcy5ZGhDLYsmlLKn4pOeHM2wia8a4Du7f5TFrUU8k9ZkxgxQrRmNJCwQbKTDRmScPOcL45K1KUwQ7/fHDlzOUdE3XIUkafzM4FDeafPdv9wAMkOlpUNjVLGxAjXUKarlywH3d32sftRUrEmlR0X2De03Npu+NoIpO4GDWme9trPFrRyREs8OmnvldfNffvR2rjZQJ3een5vbFztdTdjXRQHmRWK84p/kiBBvvsmTnY5O3MDDkzuw3OgQ3CBDp0orW1+oIF+saNqKaGm6aQb0JIly506FA6ZAjWNH3GPYFdb2Nrx+DgUvfLtbu+iRToo9uPfj9rMaXH1KO1oBHBsqZk9e/antNoC+iWmGfCWdy9LuhF3ETyeeOUayaFk29D+/79RSVFpeAMwT9bV3tHRbzRbVCOrLUrT+4s0GCeh+K4VhVizZA25Blp5N/CybfeIGD45MmPJEUOnUxrQCPG0/OznIntLWY6ETR3V3ieyER2T+jyfMj+VBGObdcD2GbTffonz85XZIMgs1UtLEldu3TJSWn/CXQiaDC+/VvP9N/iOnlkNSTqlWqsOsLC9kQrXzbzh6UBD06j2KVBwNcsaCxhbrCE7C6ZfdpekdTQOhc0mLH1c/+M63GdvrFAjGNiGSK0XTttvbGjBcYrAzhF2+moPdJ1mJtqlAz6C5FfEDQGvpIFnRLT5FEJzryhebSteeDJ1umgwfyf3WWsfifIGg5GtDNsT23s7IM2NFa+1/t8HlZNODzc4VpdLv7NV0V7TdPrY5wrGpXtGmJI1qjNYUNRuPfZfZxdYjr2HMIBGsz37m/MPd9jKwyFIES56DH5sufDcFxhAb/3hQzmLQtG0tyLtDs+lfKvR1Y6w0xWXVzjrart0j1ZtikUCkzSKUPKwgQazP10LvbvDi5zHclXvqgM+2s4jjvegag7RFlHyrWvykPGhueSG1r4QCMz4BqrkujQX9xAtj9+Rfr+rlOP6Xv7UrNoIbYCaLhQJf8P8u9nhul6j7cwggatPLzR+9IgXNc2y2qR43VrsGLnmH/27cbGD0J6BWWD42zb42vCdrEnWFhBg7GCT70f3lgfhHBXTNSrpYg0W7jrXu6rRkwPVm9b/XgkpEVjpbkw0fv+HWzXtHpfxka6/aWD4bzSEyzcoMH8Xz9qrnwR1SEgKefbxq44aSsOcSHbPs8sLOAV+7jfdeL3skacmVKvc0iP4VK/m7ES1fBLtuYD77zbj1Gmqfa/FyIayZG8EQAN5v77QOTfdEw6s34v3/Nh8CteURhY8Hf9h1nYLkaZi0KMN/ggq6G17hM69wCSc6+iv3uUZA0RlMt2eSbkkQYCFTWxEttiI0g5YqDBvJP6sJIdIdYGUkfPknIu9k28lLk3I9lqtTYQlxF3pmJHCnekMnuCqNfGGJsB5C7B7iO45gguPwDxL8TGHPYD0mJq2vWv+j+/G9f5Lgsgx+O7UXyPyFKOJGhUW+KekIOxK9Tx0MBAFmkcm1BsIRaVyLsO4/E5XI1FWozIJLHEJVksSAqiNuHqRgDrNfiXH6Rd83HFQWvoGGrYuimCuVuny4NuizTkyIIWz/jP3hd71xeMwjfBK5O7s8whLKEnCqo4kCUUEwlJMifwUUQHLWtBDEOSNKQ4OFVJ4RK67i18qAjZQ7/jDKnXvkXPuTvShEMWSdBggXmPGj+9KMQX0uOoaN79YhbfEwIMjImFlWLhxdZHAuIyI7IFWqlfI1ZSBUFhqMaRfYvot+Ow3wDxEaBvmUEH/jHShE8D0Kx0h+eFvkRh4MssMZtlnAe8sBhCbo2tw4BVwVSCBUHWWgBHFn3jsYUY+IoFyq0FISy2OOwqposfIUUbkSKkX7nsaXlEuHsJn16gec1h99+yid0PvsySe/KMIZwFW8UsrCF9kMU0FSGPtgRarFE4kXBoDbi2ZC3AXRHuz2VIuFW6cLy0+Rtuh/AZKWM+p/mRnzYkQqB9Va5HkohdB1/mqf1ZYh5m5vGyEFoQg0eJtVwHuk6s61VFEsWjtUYMzRN3QkWx3eT5d5OCzyFugeDPfu9CnBPWTtmnC2jv47kM7YYAgyXm8MTcoFwIV5UsWQBwoL9iwfJfDEytmUCw5enWApMkHFpDrY3hBlgrrQUhI1qM/PU9ZOcSDrpiT7M/BglLG3tz/buCZps+9H78RwjCuGqHAEP0NxM+K1xViHKdFNQXd0KXJQk3WGMJiOXUYo1S/3Ph1OKxsDYQISBXZo7AtRWiC2jS7+zjvvpPAq17XQ/ZiQOCMMlMHYSJUscupACWgNA60PUCIuGQpBwTEGZJioW1XlvEMpMU665QrjqJt1ye8huI+bgf2Z/YjRMilrmEG3Tg67H6iteFO8dmQr4n0gsRYCgCnxVpWHGFpQDEmmBFxBUi0hACEoo0JGuNYt0YKgpGK/YQYbW1H2tjEGuxHxSVKn/zANn6JYdNug233b3kPwO04fc8nsylanBDlpCLj8XFx8kCOxZpKA1UBb5VkWITdUNyFDZ8KOCCZeZMR7IdMUgoGUTfwYhF7NbaIad27KtUZl6MGBdO/fQhHN3egWz/BqDNxW/4Fj0gejA5UxjEvKIbpFAAfHxQUR+r1UsKFIkAlyNGKvbi8l34yGbst+qVgp2hYmNYr2vM7EuQFgd5N+zWknU5JCDOFLroMWnDbIhAaO7l6u2R6TMVVtCuvyYRqVT0NY3P5gQLfaAiqBDFWujBl4IKAIIghqFjK25Tbdg0cdkOfHA1DvgFXKnBYAlu5e6QWDqjzQFjWM8rkGklllTmWBStXHWQyiL5w2sh/CAo0fbcIfGg/LpBu/8i0HGqckey5c4na0V9MRiMi21IjSZHN+LizdjtFi3Y+ITxKMfjhuxn4EjzzPstvybBclWE1USWP7uFlOwBp7ZfuxyfeeGvGbS5b7nvjWECtBbNIdXGx4IKS1WVumSvrqyjduQtI+DFbpdw4ZY0eMGl+BDP7K1f8pLYDyKWgFBuS6ArJkgbZkFeLp0xVr3p1V8zaGPDDP+sMQCaqdFQiFm6EQoqkBVUiBA4WGsBmYWkkJJtuLLQauxrzWG4qMhm6f2Ny1/Fhp9ZGZCI8w78IM8byyG2NpLtE4/+mkH73hvN9s4SD77iZMGSqkFQUVcAKiJOMH24ZAt21xynxS03y6/Ns24xB/0JmQEuIj8NB2qVd36LohCrRI63IpAMhw009z7Tm3l3itECih1iYRbKNYJ1+aFUkCk2XHOIVO4Xv2hP47jF2hg+juVdLfwadh6dpr7YC0DzAIp65VcMmnP3E2mYH7XaQTSrZsOqA6qvviAaxwjXHEbeSozb5MgnGJSNsqxf8TaPyRSXGZ2uTu4j6j0CyP6SHv7Of2EDzTwPxyDVZQVnwXiZ1qUVVn0bM3DtIWtWkI6gHDQd8cRu+o1zsbeCOVOVNweIWxhAtuersRrd/t23ysIH2v1oEpbKrUFxOAg62DQFCwRyPF9tRyKuNy8yzvtv1n801+KVN8+AkJL5kWOiN/xdD8InHZ5/ZHO9SKSFgiYRtRYQeAH0gAeLBLoTKCNLQDDSr5rKM4cqr/RFtl+9RoNvvX4hP2p1lAkeUMS5PPSKANQ5lINmQCLa1Rz6EJ03FmmI16Ko//lVg9anjg0ceB3XgUX1hw3DixdModfIUgtWRR1v6q36tSdQ7TM8JtNFXzQia3KUTW71kJYwZobr5/pm34w7cgqQNlnyRfaxi1uyYWHZpoU7p39RMFNntQYz6tdToiZExQ/vecNNg56IsyW38LDhA82rD7ifySKRbE5CEEFqwz6QLhnT/GbFNfv+NGeETy+UCJIhKDppFDznDND7DTQw4/zHL50bb0895aHDW3v3ICaRGShUB8iN7C9WYq3Jfngc8bu/vapoz3xNjF45tagxbvoNc1j3Pz/+28nNbxlW0IFpt+l7ZkbsbTjgmWnn2R74sanvgdp1U9MRruStTEqhTO+eMPS165Y1s01YQfOjBZ6JA3CEes+KwdIZg7V7fmyqPvr6aV1182hDPwA4zGSMcfgEQWGMCcFixlhRn95gfDlnmpI3d8zWpo4e7jZD35RzzQNrOq2Tf7MWkypnX+1f+DZOGmh76BMSn9Pwy+s+P4OVbud1I4UsxKKncFJ6fFJabEy8Q7OrnHGf319xtKbkcGV5cY1g3QA3gOyffO1zV89u9OBh7/F/aL138pk47E0coAZa/nPSrU/AsrH6zcCXz6Jipo1/h+SNBC+du+GFD9c8QeoG5gMT02RxCY7cfpmOWDsX04+wICeR1UoE/qqt9mxdW+j36Q1d268HXrl+ZX7y0MiDBnO/NgwfXR6O8LmeMvxbiaKOrx01CpcGXrua+DzqvR8OWTUqqU5PAIgeMNK7J/UZ2FX4NWucj8Btss2r9lSU1sj1E69wZDpSvx5VdPL2keipZBquR2VCw5KqBC/fh2zjVpHMcxv5qrZ44oeDlyqlarCd1/LlxOToM3/T2+cJNL/boF6v+/7nmiqPVDclpy8QePmapf3Sh524cUS6hOlr3wl8cld4khduInXo3XRkk3MpXz8z1/DvDy6D/8qKdPbw3tbsEafeOWi07jNWfLOZKvXz1nFF6vnJ7dtO3DJSvUn9n95prHmv01mDvKr5Uf9oMhio9By96YNUe91r00A0evbN7JaXYuhmC4+gqLRgzd6jBytoaH4a7tX17+49kWok+0f754wy1n3ceazFlRnpUc2OevvX9rfe+P5e2RJo8Y4qjM8d0VeWScupgHpUV7o3/rgbW2ICa7yBwHujtmbFHTeVeoR7/PunXWns/BfuhOYO0XUydoDtL6ubr3qe+uOfvyh4LQgaCreY+KgB57Vy+mKMuMHWLNsR8BvBCbcB9D9HfjM48/LjtoosaLDAZ/foq98OjcTqIOMGws6B9ifXnXJY7ouLbl2+Z3YQtGmYEDX3Pau7abAWHabOIOpYtXCrx+0Lzibk1QOPX/LRsJ6jGm4TedBgrHCxb9pIzj3tZw3pH8QY6o2vyUMfbMn2zy24/sd9n9eDTslKyB/U3TBaKtBBA5letXCb2+WtB/3IxdMvzjtuNFh7QR+u8uw65D5Y5jYZP1ThdarUGaXIEu7axTawe3yU1lJR8C95xVz4cDu9GhCTnudrt8zEcS2dcnHS0jGLds4IgYbALiWm39nZVk7YCpMkadWirT6vvx703y6be0HOcW8FayPoWq/+7Ybi5duLIe8XeZNVEwApUjB/wlbcA5Jnt9GRA1Mv7HfqSlv3WIztdYNhddG7rn6wfDPwg99y3WqyolnafR9L1uDZltvMtU/O3jAhpNGMOaJtA4fmtmqCYdhW9xtrv//ZDJi4TqNfunbJgLTh7QLtDRiTvtp1uNxHxQRaSKEk1i45NCnaRjVZ3FCPbrp9rMZrFtcEgvsmunnRoNSR56STJi4gMOkKvewbHBy3betqe3g9K/jIt/h9VLwZa6i58wMttmfLI+6kZ9+B7YmtupCgrSua/9S3v6uPOiCqO/fiPnanjbOWYoEUseRQxbaf9hFKQlGHHpgz5kic/bgpr1oHGlz401UHgSechkOVshLVlGhFkbEmQ5QjciP4l0pYAnfmcEvMvSX+XUc8tT4T1vh084Xf94+NOrGawyxc5ntreGgioACy//VnnJRX913APPAT27eUlexAhl9McCA8SGJUluJ7kKxzpG7DkOZsT4pZZpbcNiWZ1k3eD+qcCjI9uHur4uhVi7a5a7yh9zVw5NIDi+9rRxy9YNPR+esOW3UoqFeaLcmpiAEPwXoWuHoClEVKKt4XJ3DDDUYqlUzO1+2r3VjkFvT9xoir8q7ObNCngjPP+HguV4sxALCrtJH2+8P6EgCwUTMGugPbQ6cjKpD44At7OWPsINmn/C3c8bIj1etX7gTc9ZlhTuzlk278so2g319cuHFfFUhQfJTSM0UDlHBGgizClIrXS8FRqHh/YZC14A4LVNAnUapU7dHnF1RWugxQgr7dkm8bkRHcrffli1j50hBlM9n+YgS6H+4v23rnnH62uuSQiYZ5fMEV/aGIY82yBspV5a4NK3dZbwIKPVWmNzDp7m25Sp+2gP5s9YHl28qAcqKTpsUpwo8xF7M8gUoAbus9XqJjF673aCwGool2TCEj8JEpPN5k3rqyCrcBBeafR/bMSXLyQxs8kwcHq0yhQNMe+FHKOi/8oMGueiMRKzXHYJnMFqX2Oysb/LrRUE+8EpNKZcXV29cXGQGj/iUvjLPcpOGvXPNdIz85JejCQ77J324FpE5NykwQbaui+gSDOwv1tyaAFbPxAW7x8BBkuTMH6bAa5wV0Kub4xhD0wVP56U9ltV7DwNrLt3RTn8/xMeHCcAZyyk3Kg3MiQhmsqKLgzo8H2Bu8KB5Yw5ln5iTn5KfDyTOrPlrcB+FSkt8fKNp5ZP+uYjEshBzLiao8gW/vrbXJjTSMnuoF7IyPe3897FqlJC1Oxly0KVApSFPEcLROnYV0wN0QrTxctPVIQkmIOBEO3ixGohCsSMSvs0/Xlfm5nObdMn7/rbolGsyFHJHo1NLQZq59ds7Gpyg5xloEIYaYKi8hOSYu0anZFcAd8OrgyJWltXCdUl2YETS/EZh49dL+acMa3f8pQH/506HFBSVALdEBcm8BFT4rtEL4KXgx4qJTiRAKTsWrF5FCiCna9YUjawoRns1EJiz0WsJQPO4u9i3dUS0r2uhDDw6qWQRPpjrmC9RrZGRBg01eeteSXdMIOW6S6GDdPw8mCFat0wktWEELGIHfn/WP0Wf+vamdNwfaMPm4DzbIEgFe0YAZfBML36TWcWiouONY+C0G1grFLr95qDLg9TNQYjHKT5HgOeiZEmWKk7UkBcpGjXy4stRjSnFmyTO7Li7tfWuX/4rk9PQN7bGv/7Dhl/9VZeXkgLG+cfbkL1wB/b4LX7mu/0PN7Lk50PM3HFy8uQx25LSJucCtxl9xJ6nELYmokw7wYgkeHLS/3FftNq0304XGpjHrbtlkckbXqK6JmlUPiSCv2V/qX76zhmkx/7X75qdL7yz2oKH5qddd0OeCc3NQpG1P2bq/zL5MpxWUCPFrKkYXYRJHBtOJlDzrj9ucanzzu20O9EPTNoEXg9sCGjHyhorqTHBLEWmIsxCCTS3JdvvZgQq/NVVaI7dcNNdzlBKrnNvDIVmPHQTX/9pU6WdSF16mYPNImftwSW2V26cqdMLdl/bNO3XHn041iFznbXj5440Ta/1lYgLkxswfCMhxmfcNeuryXne0ZJ/Ngb7/3Q2gBsSKLuCpl6zQzZILkUsL6QC5kHC1xyyt1a0sv8lKAtHiafL4KHpBboyqEngCFm+rPlqtJ8fIF+WISYWrav27D1QtWf/L4dKaG0f0Hzt6KIq0Ae4dJSvnrvtg69EVB6v21K/vkdhvYMalNwy4rWtCv5bvrUnQRyp9Ez7bJpI/xC25EPP4S6LowzSUksBKXOM1arwmwaglFTEgI/CTC/Kik2OUnYc964tcEBRemUc1MVU5xNoEQsDPlu5eveVgZnzU9BdGRxp1R1qToLcfqJ7y7R5NlupKWySCCuHRYNxSDOzTWcspo+DUdaKyBg/r4zRNtGRHNWj9lb0Um8Lre00oVFq+6cCCVUU3XNr3nhsik7+EFfTmoqp3Fu4F0CFGwFpUvGKrM5QADSG2O8CD/t7y4wVZQ4wPMlJaK16yelGOFG8j9ZVlQdafLtv946YD//fqbV3iolq+89PZmga9r/LdRYWqfCyoDEaSxJr3AfAGjOBMi216h5YITEVVFATRw7pKXaIJa1CpYLGmE6avdjjwrAmnyzRf7bSWenQIkAVJVPCjUPTenmNzK/4bli0l2skJ1b+qIi1bf3DhmqLZE0clxnb8S1nDb02C3rK/6u3vTgSN6lijtvrycbviyOToil6yXUYnnAWUtCWVnulfb/vtkJ5339y6RpPT05oEfbjC+/xn21W57S8tOqUJj+boyl4i6jj5LCiVps7bBDd2xnO3RJpSB1iToGH1/e+t08S4+M46NlCOUUE6ZNJYnwC7RqfP37a9sGzJu3+KNKUOsOYSlj+9vdahyh312tmTDUrTnol4YBo1Wd1kMg3MptK5i3cuW1f006wWdRw4za050F/8dHj51uJOAi3eyM7RRdk0MQo32hBq1+QZ/9q6ZXfJsmmny0Su7bHmQLt9xsMzNtvVTpFpgAtJ/PV9lUBjnSismJ1MnbcZEqQZz9wUaUodYKeoj35v0d6tv9RIHf1qEtH70ERnpks5iaTRZjlIiipr/NO+3Dx8YLextw2LNKUOsFOAhqxk/LQNVG3bDCVNGjhxrA2PyKFN9Z7QFGnp+gPf/Ljv6zfGOGwRmGuqw+3UbYaf7K9es3AvJN0ddUirRR9d1IPG2TFrzJ2x1bj+4v+uyUyOnfLYNZFG1DHWolbwf3y8pdpnkI4oFYNl4KBU0rOL1KhoiPxbpvN/LFy4at+7T1/XN7sDXnF3OlhL+3VM/mrX/lJ3O8VaTHzOUI8EfE6W7NMbKwMxhhRpycZfvlq6a+wfhtx0ycBI8+kwaylo2OrNBbv3HHaRdrDGhOQlkn7JpNFIQ6YSY2zBmv1rtxzq2i9t6n1XRBpOR1rr+t69/tXPew675VYGfDw42gnh8qJ9+em2c/ulxzo03bCUwxrQHuytsGVv+crNBwt2l9wwrPcjd14caTIdbK3uTXrYFXjry59rPIYUGobU7DvCrerQgG6em5d07dkp/5z63erthwFxXreE7qmxMQ6FUuLy6CWV3q17S2vd/vhY+7N3Xdy/V3qksXS8tbF/9JZfquavO1JU6rZrFAW78JzUkxlcFvbdOzNm9IVZ0bbQkKDiCteydXvnLizw+0yfX/QOpVTSVKlvt6SrLso/Kz+zPdJ0Olu7evxDlL19T8X2Us++Ehe4bbCCGv5x2mh2ctTgHvFpcTYqNQ4O/NowRBgNZBVZ6pCQ5nS2/weN/E7j2bHlVQAAAABJRU5ErkJggg==';

//-------------------------------------------------
// entrypoint
//-------------------------------------------------
cs.graph.start = function(){	
	//如果直拿就將寬高對調
	if(window.innerWidth < window.innerHeight) {
		//var w = cs.graph.Width;
		//cs.graph.Width = cs.graph.Height;
		//cs.graph.Height = w;
		cs.graph.Width = 768;
		cs.graph.Height = 1004;
	}
	
	var director = new lime.Director(document.body, cs.graph.Width, cs.graph.Height);

	var scene = new lime.Scene();

	drawLayer = new lime.Layer();
	objLayer = new lime.Layer();
	lineLayer = new lime.Layer();
	pointerLayer = new lime.Layer();
	buttonLayer = new lime.Layer();
	topLayer = new lime.Layer();
	
	scene.appendChild(drawLayer);
	scene.appendChild(objLayer);
	scene.appendChild(pointerLayer);
	scene.appendChild(lineLayer);
	scene.appendChild(buttonLayer);
	scene.appendChild(topLayer);

	//避免整個畫面的捲動(2018.04.01加入)
	document.addEventListener('touchstart', function(e){return;}, {passive: false });
	document.addEventListener('touchmove', function(e){e.preventDefault();}, {passive: false });
	setTimeout(function() { window.scrollTo(0, 1) }, 100);

	
	director.setDisplayFPS(false);	//關掉左上角的 FPS 資訊
	director.makeMobileWebAppCapable();

	cs.graph.init();
	
	// set current scene active
	director.replaceScene(scene);
	

}
//-------------------------------------------------
// load config from external script files
//-------------------------------------------------
cs.graph.init = function() {	
	game.Util.loadSettingFromExternalScript(cs.graph.config_file, function() {
		if( typeof(cfg_colors) == 'undefined'
				|| typeof(cfg_nodeObjectSize) == 'undefined'
				|| typeof(cfg_lineSize) == 'undefined'
				|| typeof(cfg_longpressTime) == 'undefined'
				|| typeof(cfg_nodeObjectDefaultColor) == 'undefined'
				|| typeof(cfg_lineDefaultColor) == 'undefined'
				|| typeof(cfg_locale_LANG)  == 'undefined' ) {
			//alert('Failed to load the configuration file : '+cs.graph.config_file);
			cs.graph.showMessage('Error', 'Configuration file load failure : '+cs.graph.config_file,9999).setPosition(cs.graph.Width/2, cs.graph.Height/2);
			return;
		}
		cs.graph.defaultNodeObjectSize = cfg_nodeObjectSize;	//節點的預設大小
		cs.graph.defaultLineSize = cfg_lineSize;	//節點連接線的預設粗細
		cs.graph.defaultLongpressTime = cfg_longpressTime; //預設按下多久為長按
		cs.graph.nodeObjectDefaultColor = cfg_nodeObjectDefaultColor; //節點新增時預設的顏色
		cs.graph.lineDefaultColor = cfg_lineDefaultColor;		//連接線新增時預設的顏色
		cs.graph.colors = cfg_colors; //顏色化碼清單
		
		var debug = parseInt(game.Util.gup('debug'));
		if( !isNaN(debug) ) {
			cs.graph.debug = debug;
		}
		
		var langFilename = 'lang_'+cfg_locale_LANG+'.js';
		game.Util.loadSettingFromExternalScript(langFilename, function() {	
			if( typeof(cfg_messageStarupCaption) == 'undefined' 
					|| typeof(cfg_messageStartupDescription) == 'undefined' ) {
						
				cs.graph.showMessage('Error', 'File load failure : '+langFilename,9999).setPosition(cs.graph.Width/2, cs.graph.Height/2);;
				return;
			} else {
				cs.graph.letsRockIt();
			}
		});
	});
};
//-------------------------------------------------
// create tool buttons
//-------------------------------------------------
cs.graph.letsRockIt = function() {
	var labelCredit= new lime.Label().setText('v.1.4b ')
									.setSize(50, 12)
									.setAlign('right')
									.setFontColor('#819FF7')
									.setFontSize(8)
									//.setStroke(1)
									//.setPosition(0, 22)
									//.setPosition(52, cs.graph.Height-9);
									.setPosition(cs.graph.Width-25, cs.graph.Height-10);
	buttonLayer.appendChild(labelCredit);	
	labelCredit.getDeepestDomElement().title = 'by gsyan 2023.06.08 12:38:00 updated';	
	goog.events.listen(labelCredit, ['mousedown','touchstart'], function() {
        goog.global['location']['href'] = 'https://gsyan888.github.io/csunplugged/';
    });
	//------------------------------
	//左側工具
	//------------------------------
	//新增節點
	addSprite = new lime.Sprite()
						.setFill(cs.graph.addIcon)
						.setSize(64,64)
						.setOpacity(1)
						//.setPosition(32, cs.graph.Height-155);
						.setPosition(cs.graph.Width/2, cs.graph.Height/2);
	buttonLayer.appendChild(addSprite);
	
	//addIcon button 的滑鼠事件
	goog.events.listen(addSprite,['mousedown','touchstart'],function(e){
		if( cs.graph.clickEnabled ) {
			//將圖示移到側邊
			if( addSprite.getPosition().x == cs.graph.Width/2 ) {
				addSprite.setPosition(52, cs.graph.Height-164);
				downloadSprite.setHidden(0);
			}
			//新增節點
			var newObj = cs.graph.createObject();
			objLayer.appendChild(newObj);
			cs.graph.popupMenu(newObj);
		}
	});
	
	//
	//downloadIcon
	//
	downloadSprite = new lime.Circle()
						.setFill(cs.graph.downloadIcon)
						.setSize(64,64)
						.setStroke(1, '#21610B')
						.setHidden(1)
						//.setOpacity(alphaValueDisabled)
						.setPosition(52, cs.graph.Height-64);
	buttonLayer.appendChild(downloadSprite);
	downloadSprite.enable = false; //用來控制其它按鈕可執行功能否
	
	//downloadIcon button 的滑鼠事件
	goog.events.listen(downloadSprite,['mousedown','touchstart'],function(e){
		if( downloadSprite.getHidden() == 0 ) {
			if( saveSprite.getHidden() == 1 ) {
				cs.graph.clearAllChildren(topLayer);
				cs.graph.clickEnabled = true;
				saveSprite.setHidden(0);
				loadSprite.setHidden(0);
				exportPNGSprite.setHidden(0);
				downloadSprite.enable = true;
			} else {
				cs.graph.closeDownloadMenu();
			}
		}
	});
	
	//匯出成 PNG 檔
	//exportPNGIcon
	exportPNGSprite = new lime.Sprite()
						.setFill(cs.graph.exportPNGIcon)
						.setSize(64,64)
						.setStroke(2, '#2E64FE')
						.setHidden(1)
						//.setOpacity(alphaValueDisabled)
						.setPosition(52+75, cs.graph.Height-64);
	buttonLayer.appendChild(exportPNGSprite);
	
	//eraserIcon button 的滑鼠事件
	goog.events.listen(exportPNGSprite,['mousedown','touchstart'],function(e){
		if( exportPNGSprite.getHidden() == 0 ) {
			//將圖形重繪
			drawSprite.setHidden(1);
			cs.graph.exprotAllParts(drawSprite.ctx);
			//製作 PNG 檔
			var dataURL = drawSprite.ctx.canvas.toDataURL("image/png"); //.replace("image/png","image/octet-stream");
			//dataURL = dataURL.replace(/([^;]+)/i, "data:image/octet-stream");
			//
			//window.open('http://www.google.com.tw/', '_blank');
			//alert(dataURL);
			var anchor = document.createElement('a');
			anchor.setAttribute('download', 'graph.png');
			anchor.setAttribute('href', dataURL);
			anchor.setAttribute('target', '_blank');
			document.body.appendChild(anchor);
			anchor.click();
			//anchor.parentNode.removeChild(anchor);
			document.body.removeChild(anchor);
			//alert(ua);
			//location.href = dataURL;
			//window.open(dataURL, '_blank');
			
			cs.graph.closeDownloadMenu();

			//'輸出圖檔', '已將圖形輸出成 PNG 格式的圖檔'
			cs.graph.showMessage(cfg_messageExportPNGFormtCaption, cfg_messageExportPNGFormtDescription, 5);

		}
	});
	//匯出 JSON 檔
	//saveIcon
	saveSprite = new lime.Sprite()
						.setFill(cs.graph.saveIcon)
						.setSize(64,64)
						.setStroke(2, '#2E64FE')
						.setHidden(1)
						//.setOpacity(alphaValueDisabled)
						.setPosition(52+150, cs.graph.Height-64);
	buttonLayer.appendChild(saveSprite);
	
	//eraserIcon button 的滑鼠事件
	goog.events.listen(saveSprite,['mousedown','touchstart'],function(e){
		if( saveSprite.getHidden() == 0 ) {
			dataURL = cs.graph.exportToJsonFormat();
			var anchor = document.createElement('a');
			anchor.setAttribute('download', 'graph.json');
			anchor.setAttribute('href', dataURL);
			anchor.setAttribute('target', '_blank');
			document.body.appendChild(anchor);
			anchor.click();
			//anchor.parentNode.removeChild(anchor);
			document.body.removeChild(anchor);
			
			cs.graph.closeDownloadMenu();
			
			//'匯出資料', '已將圖形匯出成 grph.json，下次載入後即可繼續編輯'
			cs.graph.showMessage(cfg_messageExportJSONFormtCaption, cfg_messageExportJSONFormtDescription);
		}
	});
	
	//load JSON File
	loadSprite = new lime.Sprite()
						.setFill(cs.graph.loadIcon)
						.setSize(64,64)
						.setStroke(2, '#2E64FE')
						.setHidden(1)
						.setPosition(52+225, cs.graph.Height-64);
	buttonLayer.appendChild(loadSprite);
	
	//loadIcon button 的滑鼠事件
	goog.events.listen(loadSprite, ['mouseup', 'touchend'],function(e){		
		if( loadSprite.getHidden() == 0 ) {
			//if( /Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ) {
				//'系統訊息', '抱歉！Android / iOS 暫不支援匯入舊檔的功能'
				//cs.graph.showMessage(cfg_messageOsNotSupportedCaption, cfg_messageOsNotSupportedDescription, 5);				
			//}
			inputFile = goog.dom.createDom('input', {'type':'file', 'accept':'.json', 'style':'display:none;'});
			topLayer.appendChild(inputFile);
			inputFile.click();
			goog.events.listen(inputFile, ['change'] , function(evt) {
				var files = evt.target.files; 
				// FileList object
				if( files.length > 0 ) {
					var file = files[0];
					// Only process JSON files. text/json
					if (file.name.match(/\.json/i)) {
						var reader = new FileReader();

						// Closure to capture the file information.
						reader.onload = (function(theFile) {
							return function(e) {
								cs.graph.importFromJsonString(e.target.result);
							};
						})(file);

						// Read JSON file as text
						reader.readAsText(file);						
					} else {
						cs.graph.importFromJsonString();
					}

				}				
			});
			cs.graph.closeDownloadMenu();
		}
	});	
	
	//匯出圖形用的 canvas
	drawSprite = new lime.CanvasContext()
								.setSize(cs.graph.Width, cs.graph.Height)
								//.setOpacity(.5)
								.setHidden(1)
								.setPosition(cs.graph.Width/2, cs.graph.Height/2);
    drawSprite.ctx = drawSprite.getDeepestDomElement().getContext('2d');
	drawLayer.appendChild(drawSprite);
	
	//'GRAPH : 由加號開始', '試試【按一下】、【長按】、【拖曳】'
	cs.graph.showMessage(cfg_messageStarupCaption, cfg_messageStartupDescription);

	cs.graph.clickEnabled = true;
}
//-------------------------------------------------
// hide export,save and load buttons
//-------------------------------------------------
cs.graph.closeDownloadMenu = function() {
	saveSprite.setHidden(1);
	loadSprite.setHidden(1);
	exportPNGSprite.setHidden(1);
	downloadSprite.enable = false;				
}
//-------------------------------------------------
// show message on top layer
//-------------------------------------------------
cs.graph.showMessage = function(caption, description, delayTime) {
	cs.graph.clearAllChildren(topLayer);
	//設定字型
	var font = "'標楷體' , 'BiauKai'";
	
	var width = cs.graph.Width*.9;
	var height = 160;
	var x = cs.graph.Width/2;
	var y = cs.graph.Height/2-height/2-60;
	var dialog = new lime.RoundedRect().setRadius(40).setSize(width, height)
							.setFill(0xff, 0x99, 0x00, .8).setStroke(5, '#ff9900')
							.setPosition(x, y)
							.setOpacity(1);
	
	var label = new lime.Label().setSize(width*.9, 90).setFontSize(52)
							.setPosition(0,-20)
							.setText(caption).setFontColor('#ffff00').setFontFamily(font);
	dialog.appendChild(label);
	var labelMessage = new lime.Label().setSize(width*.9,60)
									.setFontSize(40)
									.setPosition(0,35)
									.setText(description)
									.setFontColor('#ffffff')
									.setFontFamily(font);
	dialog.appendChild(labelMessage);
	//自動調整字型大小至符合一行的寬度
	cs.graph.tuneFontSizeToFitOneLine(label);
	cs.graph.tuneFontSizeToFitOneLine(labelMessage);
	
	if( typeof(delayTime) == 'undefined' ) {
		var delayTime = 8;
	}
	var ani = new lime.animation.FadeTo(.3).setDuration(delayTime);
	dialog.runAction( ani );
	goog.events.listen(ani, lime.animation.Event.STOP, function() {
		try {
			this.getParent().removeChild(this);
		} catch(e) { };
		if(typeof callback == 'function') {
			callback();
		}
	}, false, dialog);
	
	topLayer.appendChild(dialog);
	
	return dialog;	
}
//-------------------------------------------------
// 慢慢調小字型, 直到總高度沒超過為止
//-------------------------------------------------
cs.graph.tuneFontSizeToFitOneLine = function(label) {
	var newSize = label.getFontSize();
	var width = label.getSize().width;
	if( width > 0 ) {
		do {
			var m = label.measureText();
			if( m.width > width ) {
				newSize -= 2;
				label.setFontSize(newSize);
			} else {
				break;
			}
		} while( newSize > 8);
	}
}
//-------------------------------------------------
// 將繪圖物件畫到 canvas
//-------------------------------------------------
cs.graph.exprotAllParts = function(ctx) {
	ctx.clearRect(0, 0, drawSprite.getSize().width, drawSprite.getSize().height);

	ctx.lineWidth = 1;
	ctx.strokeStyle = "#000000";
	//節點的部份
	for( var i=0; i<objLayer.getNumberOfChildren(); i++ ) {
		//circle
		var obj = objLayer.getChildAt(i);
		var radius = obj.getSize().width/2;
		var x = obj.getPosition().x;
		var y = obj.getPosition().y;
		ctx.beginPath();
		ctx.arc(x, y, radius, 0, 2 * Math.PI, false);
		ctx.fillStyle = 'rgba('+obj.getFill().getRgba().toString()+')';
		ctx.fill();
		ctx.closePath();
		ctx.lineWidth = obj.getStroke().getWidth();
		ctx.strokeStyle = 'rgba('+obj.getStroke().getColor().getRgba().toString()+')';
		ctx.stroke();
		//inner circle
		if( obj.inner.getHidden() == 0 ) {
			radius = obj.inner.getSize().width/2;
			ctx.beginPath();
			ctx.arc(x, y, radius, 0, 2 * Math.PI, false);
			ctx.closePath();
			ctx.lineWidth = obj.inner.getStroke().getWidth();
			ctx.strokeStyle = 'rgba('+obj.inner.getStroke().getColor().getRgba().toString()+')';
			ctx.stroke();
		}
		//text
		if( typeof(obj.label) != 'undefined' ) {
			var txt = obj.label.getText();
			var pos = obj.label.getPosition();
			var fontsize = obj.label.getFontSize();
			var fontFamily = obj.label.getFontFamily();
			ctx.font = fontsize+"px "+fontFamily;		
			ctx.textAlign = "center";
			ctx.fillStyle = obj.label.getFontColor();
			//ctx.fillText(txt, x+pos.x, y-pos.y);
			// wrap the long text
			var maxWidth = obj.label.getSize().width;
			var lineHeight = obj.label.getLineHeight()+fontsize;
			var lines = [];
			var line = '';
			var dy = 0;
			//console.log(txt);
			for(var n = 0; n < txt.length; n++) {
				var word = txt.substr(n,1);
				//-------------------------------
				//斷字處理
				//檢查如果是英文數字, 
				//就抓下一個字, 一直抓到非英數才停
				//-------------------------------
				var k = 1;
				var nextOne = word;
				while( (n+k-1) < txt.length && /^[a-z0-9]+$/i.test(nextOne) ) {
					nextOne = txt.substr(n+k,1);					
					if( /^[a-z0-9]+$/i.test(nextOne) ) {						
						word +=  nextOne;
						k++;
					} else {
						break;
					}
				}
				n += (k-1);
				//-------------------------------
				//斷字處理結束
				//-------------------------------
				var testLine = line + word;
				var metrics = ctx.measureText(testLine);
				var testWidth = metrics.width;
				if (testWidth >= maxWidth && n > 0) {
					//ctx.fillText(line, x+pos.x, y-pos.y+dy);
					lines.push(line);
					line = word;
					dy += lineHeight
				} 
				else {
					line = testLine;
				}
			}
			lines.push(line);
			//draw all lines
			dy = fontsize/2 - lineHeight*(lines.length-1)/2-obj.label.getLineHeight();
			for(var n=0; n<lines.length; n++) {
				ctx.fillText(lines[n], x+pos.x, y+dy+lineHeight*n);
			}
		}
	}
	//連接線的部份
	ctx.lineWidth = 1;
	ctx.strokeStyle = "#000000";
	for( var i=0; i<lineLayer.getNumberOfChildren(); i++ ) {
		var obj = lineLayer.getChildAt(i);
		var points = obj.getPoints();
		var angle = (360-obj.getRotation())*Math.PI/180;
		var pos = obj.getPosition();
		ctx.save();
		ctx.translate(pos.x, pos.y);
		ctx.rotate(angle);
		//line and arrow
		ctx.lineCap = 'round';
		ctx.beginPath();
		for(var j=0; j<points.length; j++) {
			var p = points[j];
			if( j == 0 ) {
				ctx.moveTo(p.x, p.y);
			} else {
				ctx.lineTo(p.x, p.y);
			}
		}
		ctx.closePath();
		ctx.fillStyle = 'rgba('+obj.getFill().getRgba().toString()+')';
		ctx.fill();
		//text
		if( typeof(obj.label) != 'undefined' ) {
			var txt = obj.label.getText();
			var pos = obj.label.getPosition();
			var fontsize = obj.label.getFontSize();
			var fontFamily = obj.label.getFontFamily();
			var scale = obj.label.getScale();
			ctx.textAlign = "center";
			if(scale.x==-1 && scale.y==-1) {
				//flip the text (degree 90~270)
				ctx.scale(-1, -1);
				//pos.x = obj.getPosition().x/-2+pos.x/2;
				pos.x *= -1;
			}			
			ctx.font = fontsize+"px "+fontFamily;
			ctx.fillStyle = obj.label.getFontColor();
			ctx.fillText(txt, pos.x, pos.y+(fontsize+obj.label.getLineHeight())/4);  //+(obj.label.getLineHeight()-fontsize)/2);
		}		
		ctx.restore();
	}
}
//-------------------------------------------------
// convert (r,g,b,a) to hex string => #rrggbb
//-------------------------------------------------
function rgbaToHex(rgba) {
	var color = rgba.split(',');
	var r = parseInt(color[0]);
	var g = parseInt(color[1]);
	var b = parseInt(color[2]);
    return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
}
//-------------------------------------------------
// 匯出設定、節點及連接線的相關資料成為 JSON 格式
//-------------------------------------------------
cs.graph.exportToJsonFormat = function() {
	var data = new Object();
	//設定
	data['config'] = new Object();
	data['config']['colors'] = cs.graph.colors;
	data['config']['nodeObjectSize'] = cs.graph.defaultNodeObjectSize;
	data['config']['lineSize'] = cs.graph.defaultLineSize;
	//節點的部份
	data['nodes'] = [];
	for( var i=0; i<objLayer.getNumberOfChildren(); i++ ) {
		var child = objLayer.getChildAt(i);
		var node = new Object();
		//node.color = 'rgba('+child.getFill().getRgba().toString()+')';
		node['color'] = rgbaToHex(child.getFill().getRgba().toString());
		node['pos'] = child.getPosition();
		node['size'] = child.getSize(); //2023.05.08 add
		node['innerHidden'] = child.inner.getHidden();
		node['lines'] = [];	//記錄 lines 的 index ,所以最後分析填入
		if( typeof(child.label) != 'undefined' ) {
			node['label'] = new Object();
			//文字先編碼過，以免中文出問題
			//node['label']['text'] = encodeURIComponent( child.label.getText() );
			node['label']['text'] = child.label.getText();
			node['label']['color'] = child.label.getFontColor();
			node['label']['fontSize'] = child.label.getFontSize();
			node['label']['pos'] = child.label.getPosition();
		}
		data['nodes'].push(node);
	}
	//連接線的部份
	data['lines'] = [];
	for( var i=0; i<lineLayer.getNumberOfChildren(); i++ ) {
		var child = lineLayer.getChildAt(i);
		var line = new Object();
		/*
		line.points = [];
		var points = child.getPoints();
		for(var j=0; j<points.length; j++) {
			line.points.push(points[j].x);
			line.points.push(points[j].y);
		}
		*/
		//line.color = 'rgba('+child.getFill().getRgba().toString()+')';
		line['color'] = rgbaToHex(child.getFill().getRgba().toString());
		line['pos'] = child.getPosition();
		line['rotation'] = child.getRotation();
		line['shapeType'] = child.shapeType;
		line['connect'] = [-1, -1];	//記錄 nodes 的 index ,所以最後分析填入
		if( typeof(child.label) != 'undefined' ) {
			line['label'] = new Object();
			//文字先編碼過，以免中文出問題
			//line['label']['text'] = encodeURIComponent( child.label.getText() );
			line['label']['text'] = child.label.getText();
			line['label']['color'] = child.label.getFontColor();
			line['label']['fontSize'] = child.label.getFontSize();
			line['label']['pos'] = child.label.getPosition();
		}
		for(var n=0; n<objLayer.getNumberOfChildren(); n++) {
			var obj = objLayer.getChildAt(n);
			if( line['connect'][0] < 0 || line['connect'][1] < 0 ) {
				if( child.connect[0] == obj ) {
					line['connect'][0] = n;
					data['nodes'][n]['lines'].push(i);
				} else if( child.connect[1] == obj ) {
					line['connect'][1] = n;
					data['nodes'][n]['lines'].push(i);
				}
			} else {
				break;
			}
		}
		data['lines'].push(line);
	}
	//return base64 encoded string
	//var jsonString = window.btoa(  JSON.stringify(data) );
	//UTF-16 to UTF-8 to Base64
	var jsonString = game.Util.Data.base64_encode( game.Util.Data.utf16to8( JSON.stringify(data) ) );
	if( /iPhone|iPad|iPod/i.test(navigator.userAgent) ) {
		var mimeType = 'application/octet-stream';
	} else {
		var mimeType = 'text/json';
	}
	//return "data:text/json;charset=utf-8;base64," + jsonString;
	//return 'data:application/octet-stream;charset=utf-8;base64," + jsonString;
	return 'data:'+mimeType+';charset=utf-8;base64,' + jsonString;
}

//-------------------------------------------------
// import JSON string , create nodes and lines
//-------------------------------------------------
cs.graph.importFromJsonString = function(jsonString) {
	cs.graph.clearAllChildren(topLayer);
	cs.graph.clickEnabled = true;
	if( typeof(jsonString) != 'undefined' ) {
		data = JSON.parse( jsonString );
	}
	if( typeof(data) != 'undefined' && typeof(data['config']) != 'undefined'&& typeof(data['nodes']) != 'undefined' ) {
		//delete all exist nodes and lines
		for(var i=0; i<objLayer.getNumberOfChildren(); i++ ) {
			var child = objLayer.getChildAt(i);
			cs.graph.deleteObject(child);
		}
		cs.graph.clearAllChildren(objLayer);
		cs.graph.clearAllChildren(lineLayer);
		//reconstruct all nodes and line from JSON file
		for(var i=0; i<data['nodes'].length; i++) {
			var node = data['nodes'][i];
			var obj = cs.graph.createObject(typeof(node['size'])!='undefined' && node['size']!=null?node['size']:null)
								.setFill(node['color'])
								.setPosition(node['pos']);
			//if(typeof(node['size'])!='undefined' && node['size']!=null) {
			//	obj.setSize(node['size']);	//2023.06.08 add, 改放到 cs.graph.createObject 的參數中
			//}
			obj.inner.setHidden(node['innerHidden']);
			obj.lines = [];
			if( typeof(node['label']) != 'undefined' ) {				
				//obj.label = new lime.Label().setText( decodeURIComponent(node['label']['text']) ) //文字先解碼
				obj.label = new lime.Label().setSize(cs.graph.defaultNodeObjectSize*.8, cs.graph.defaultNodeObjectSize*.8)
											.setText( node['label']['text'] ) 
											.setFontSize(node['label']['fontSize'])
											.setFontColor(node['label']['color'])
											.setPosition(node['label']['pos']);
				obj.appendChild(obj.label);
			}
			objLayer.appendChild(obj);
			data['nodes'][i].obj = obj;			
		}
		for(var i=0; i<data['lines'].length; i++) {
			var line = data['lines'][i];
			var polygon = new lime.Polygon()
									.setFill(line['color'])
									.setHidden(0);
			polygon.isLineSprite = true;
			polygon.shapeType = line['shapeType'];
			polygon.connect = [];
			for(var j=0; j<=1; j++) {
				polygon.connect[j] = data['nodes'][ line['connect'][j] ].obj;
				data['nodes'][ line['connect'][j] ].obj.lines.push(polygon);
			}
			if( typeof(line['label']) != 'undefined' ) {
				//polygon.label = new lime.Label().setText( decodeURIComponent(line['label']['text']) ) //文字先解碼
				polygon.label = new lime.Label().setText( line['label']['text'] )
											.setFontSize(line['label']['fontSize'])
											.setFontColor(line['label']['color'])
											.setPosition(line['label']['pos']);
				polygon.appendChild(polygon.label);
			}
			//幫連線加上滑鼠偵測
			goog.events.listen( polygon, ['mousedown','touchstart'], function(e) {
				if( cs.graph.clickEnabled ) {
					cs.graph.clickEnabled = false;
					//跳出功能選單
					cs.graph.popupMenu(this);
				}
			}, false, polygon);			
			lineLayer.appendChild(polygon);
			//重繪連接線
			//cs.graph.setLineSizeAndRotation(polygon.connect[0], polygon, polygon.connect[1].getPosition(), true);
			cs.graph.setLineSizeAndRotation(polygon.connect[0], polygon, polygon.connect[1], true);
		}
		//'載入檔案', '已將載入的檔案重建完成'
		cs.graph.showMessage(cfg_messageImportOkCaption, cfg_messageImportOkDescription, 5).setPosition(cs.graph.Width/2, cs.graph.Height/2);
	} else {
		//'匯入失敗', '請檢查是否為 JSON 格式的檔案或內容格式'
		cs.graph.showMessage(cfg_messageImportFailureCaption, cfg_messageImportFailureDescription);
	}
}

//-------------------------------------------------
// update connected lines position and rotation
//-------------------------------------------------
cs.graph.updateConnectedNodesLine = function(obj) {
	if( typeof( obj.lines ) != 'undefined' ) {
		for( var i=0; i<obj.lines.length; i++ ) {
			var line = obj.lines[i];
			if( typeof(line.connect) != 'undefined' ) {							
				if( line.connect[0] == obj ) {
					var another = line.connect[1];
					var isFirstPoint = true;
				} else {
					var another = line.connect[0];
					var isFirstPoint = false
				}
				if( isFirstPoint ) {
					line.setPosition( obj.getPosition() );
					//cs.graph.setLineSizeAndRotation( obj, line, another.getPosition(), true );
					cs.graph.setLineSizeAndRotation( obj, line, another, true );
				} else {
					line.setPosition( another.getPosition() );
					//cs.graph.setLineSizeAndRotation( another, line, obj.getPosition(), true );
					cs.graph.setLineSizeAndRotation( another, line, obj, true );
				}
			}
		}
	}
}
//-------------------------------------------------
// create new node object
//-------------------------------------------------
cs.graph.createObject = function(size) {
	if(typeof(size)=='undefined' || size==null) {
		size = cs.graph.defaultNodeObjectSize;
	} else {
		size = size.width;	//先假設為長寬一樣 (2023.06.08)
	}
	var x = cs.graph.Width/2;
	var y = cs.graph.Height-size*1.5
    var obj = new lime.Circle().setSize(size, size)
    							.setStroke(1)
								//.setFill(colorPicker.getStroke().getColor());
								.setFill(cs.graph.nodeObjectDefaultColor)
								//.setPosition(cs.graph.Width-size*1.8, cs.graph.Height-size*1.8);
								//.setPosition(size*1.8, cs.graph.Height-size*1.8);
								.setPosition(x, y);
	obj.inner = new lime.Circle().setSize(size*0.85, size*0.85)
						//.setFill('#ffff00')
						.setStroke(2,'#ffffff')
						.setHidden(1)
						.setPosition(0, 0);
	obj.appendChild(obj.inner);
								
    //如果中心點附近已有物件, 就稍微右移一點, 以免重疊在一起
	for(var i=0; i<objLayer.getNumberOfChildren(); i++) {
		var another = objLayer.getChildAt(i).getPosition();
		var dx = x-another.x;
		var dy = y-another.y;
		if( Math.sqrt(dx*dx+dy*dy) <= size/2 ) {
			x+= size*(Math.floor(Math.random()*20)/10)*(Math.random()>=0.5 ? 1 : -1);
			y+= size*(Math.floor(Math.random()*15)/10)*(Math.random()>=0.5 ? 1 : -1);
			if( y > cs.graph.Height-size*1.5 ) {
				y = cs.graph.Height-size*1.5;
			}
			break;
		}
	}
	obj.setPosition(x, y);
	
    objLayer.appendChild(obj);
	
    
    goog.events.listen( obj, ['mousedown','touchstart'], function(e){
		if( cs.graph.clickEnabled ) {
			cs.graph.clickEnabled = false;
		} else {
			return 1;
		}
		obj.oldFill = obj.getFill();
    	//obj.setFill('#B45F04'); // ball is colored to red when touched
		obj.setOpacity(.75);
		
		var posStart = obj.getPosition();
		
		//拖曳的指標
		var pointerSize = cs.graph.defaultNodeObjectSize/5;
		if( typeof(obj.pointer) == 'undefined' ) {
			obj.pointer = new lime.Circle().setSize(pointerSize, pointerSize)
											.setOpacity(0.7)
											.setFill('#00ff00');
			pointerLayer.appendChild(obj.pointer);
		}
		
		obj.pointer.setPosition(posStart).setHidden(0);
		
		//line.setPosition(posStart);
		
		e.startDrag(false, null, obj.pointer);
		
		// stop the event from bubbling up
    	e.preventDefault();
    	e.stopPropagation();
		
		
		//偵測是否為長按		
		var longpress = false;
		var longpressDetect = true;
		var movingMin = 4; //移動超過  4 才算拖曳
		var posTouchStart = e.position;
    	var pressTimer = setTimeout( function() {
    		longpress = true;
			movingMin = 1; //unlock the offset checking
    		e.startDrag(false, null, obj);
    	}, cs.graph.defaultLongpressTime);
		
        //animate
        obj.pointer.runAction(new lime.animation.Spawn(
            new lime.animation.FadeTo(.5).setDuration(.2),
            new lime.animation.ScaleTo(6).setDuration(.5)
        ));
		
    	var mouseStatus = 'down'; //用來檢查已 mouseup 卻還有 mousemove 繼續發生
		
    	//處理拖曳時的移動    	
		e.swallow(['mousemove', 'touchmove'], function(e) {
			var posEnd = e.position;
			var deltaX = posEnd.x - posTouchStart.x;
			var deltaY = posEnd.y - posTouchStart.y;
			if(Math.sqrt((deltaX * deltaX) + (deltaY * deltaY))>movingMin) {
				if( longpressDetect ) {				
					//e.startDrag(false, null, obj.pointer);
					longpressDetect = false;
					movingMin = 1; //unlock the offset checking
					if(typeof(pressTimer)!='undefined' && pressTimer!=null) {
						clearTimeout(pressTimer);
					}
					try {
						lime.animation.actionManager.stopAll(obj.pointer);
					} catch(e) { console.log(e) };				
				}
				
				//長按後就移動並調整相關節點的連結線，否則只拉線
				if( longpress ) {
					cs.graph.updateConnectedNodesLine(obj);
				} else {
					posEnd.x += posStart.x;
					posEnd.y += posStart.y;		
					
					//新增一條線
					if( typeof( obj.connectLine ) == 'undefined' ) {
						//obj.connectLine = new lime.Sprite().setSize(1,1)
						obj.connectLine = new lime.Polygon()
												//.setAnchorPoint(0,0)
												//.setFill(colorPicker.getStroke().getColor())
												.setFill(cs.graph.lineDefaultColor)
												//.setStroke(10, '#4AAADE')
												//.setPosition(obj.getPosition());
												;
						obj.connectLine.isLineSprite = true;
						lineLayer.appendChild(obj.connectLine);
					} else {
						obj.connectLine.setPosition(obj.getPosition());
					}
					//檢查已 mouseup 卻還有 mousemove 繼續發生
					if( mouseStatus != 'up' ) {
						obj.pointer.setPosition(posEnd).setScale(1).setOpacity(1).setHidden(0);
						cs.graph.setLineSizeAndRotation(obj, obj.connectLine, e.position);
					}
				}
			}		
		});
    	e.swallow(['mouseup','touchend','touchcancel'],function(e){
			cs.graph.clickEnabled = true;
			mouseStatus = 'up'; //用來檢查已 mouseup 卻還有 mousemove 繼續發生
    		obj.pointer.setHidden(1);
			if(typeof(pressTimer)!='undefined' && pressTimer!=null) {
				clearTimeout(pressTimer);
			}
			try {
				lime.animation.actionManager.stopAll(obj.pointer);			
			} catch(e) { console.log(e) };
			
        	obj.setFill(obj.oldFill).setOpacity(1); // ball is colored back to green when interaction ends

        	if( longpress ) {
				cs.graph.updateConnectedNodesLine(obj);
			} else {
				//如果沒有 drag, 就當 click 處理
				if( typeof( obj.connectLine ) == 'undefined' ) {
					//跳出功能選單
					cs.graph.popupMenu(obj);				
				} else { //drag
					var isFound = false;
					//測試是拖曳到哪個物件上
					for(var i=0; i<objLayer.getNumberOfChildren(); i++) {
						var another = objLayer.getChildAt(i);
						if( another != obj ) {
							if( another.hitTest(e) ) {
								isFound = true;
								break;
							}
						}
					}
					//如果是拖曳到另一個物上，就進行連線，並登錄；否則就刪除線
					if( isFound ) {
						for(var j=0; j<lineLayer.getNumberOfChildren(); j++) {
							var lineChild = lineLayer.getChildAt(j);
							//找到已存在的, 將它刪除, 以免重覆
							if( typeof(lineChild.connect) != 'undefined' && ( (lineChild.connect[0] == obj && lineChild.connect[1] == another) || (lineChild.connect[1] == obj && lineChild.connect[0] == another) ) ) {
								if( lineChild != obj.connectLine ) {
									lineLayer.removeChild(lineChild);
									if( typeof(lineChild) != 'undefined' ) {
										//複製連線的標籤文字
										if( typeof(lineChild.label) != 'undefined' ) {
											obj.connectLine.label = lineChild.label;
											obj.connectLine.appendChild(obj.connectLine.label);
										}
										//複製連線的形狀
										if( typeof(lineChild.shapeType) != 'undefined' ) {
											obj.connectLine.shapeType = lineChild.shapeType;
										}
										//複製填充顏色
										obj.connectLine.setFill(lineChild.getFill());
									}
									break;
								}        					        					
							} else {
								lineChild = null;
							}
						}
						//cs.graph.setLineSizeAndRotation(obj, obj.connectLine, another.getPosition(), true );
						cs.graph.setLineSizeAndRotation(obj, obj.connectLine, another, true );
						obj.connectLine.connect = [obj, another];
						if( lineChild == null ) {
							if( typeof( obj.lines ) == 'undefined' ) {
								obj.lines = [];
							}	 
							if( typeof( another.lines ) == 'undefined' ) {
								another.lines = [];
							}
						}
						//幫連線加上滑鼠偵測
						goog.events.listen( obj.connectLine, ['mousedown','touchstart'], function(e) {
							if( cs.graph.clickEnabled ) {
								cs.graph.clickEnabled = false;
								//跳出功能選單
								cs.graph.popupMenu(this);
							}
						}, false, obj.connectLine);
						//將線加入兩個端點中的記錄
						obj.lines.push( obj.connectLine );
						another.lines.push( obj.connectLine );						
					} else {
						lineLayer.removeChild(obj.connectLine);
					}
					obj.connectLine = null;
					delete obj.connectLine;
				}
        	}
			cs.graph.clearAllChildren(pointerLayer);
			obj.pointer = null;
			delete obj.pointer;			
    	});
	});
	
	return obj;
}
//-------------------------------------------------
// 製作功能選項選單
//-------------------------------------------------
cs.graph.popupMenu = function(obj) {
	cs.graph.closeDownloadMenu();
	cs.graph.clearAllChildren(topLayer);
	cs.graph.clickEnabled = false;

	var size = cs.graph.defaultNodeObjectSize/2+5;
	var radius = cs.graph.defaultNodeObjectSize/2+size*1.2;
	var btTotal = (typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite?10:12);
	var dA = Math.PI*2/btTotal;
	var theata = 1*dA-Math.PI*0.5;
		
	var popupMenu = new lime.Sprite();
	
	var bg = new lime.Circle().setSize(radius*2.8, radius*2.8)
								.setOpacity(0.75)
								.setFill('#E6E6E6')
								.setPosition(0, 0);
	popupMenu.appendChild(bg);
	
	
	if(!(typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite )) {
		//非直線物件的設定，就加上變大、變小的按鈕
		// resize buttons ++ (2023.06.07 add)
		var x = radius*Math.cos(theata);
		var y = radius*Math.sin(theata);
		var bt = new lime.Circle().setSize(size, size)
								.setStroke(1)
								//.setFill(cs.graph.colors[i])
								.setPosition(x, y);
		popupMenu.appendChild(bt);
		var label = new lime.Label().setText('+').setFontSize(size)
									.setFontColor('#0000ff')
									.setFontWeight(700);
		bt.appendChild(label);
		theata += dA;
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			//var scale = obj.getScale().x;
			//scale += 0.1;
			//obj.setScale(scale);
			var oldSize = obj.getSize().clone();
			obj.setSize(oldSize.width*1.1, oldSize.height*1.1);
			if(typeof(obj.inner)!='undefined' && obj.inner!=null) {
				//更新內圈的大小
				obj.inner.setSize(oldSize.width*1.1*0.85, oldSize.height*1.1*0.85);
			}
			cs.graph.updateConnectedNodesLine(obj); //更新連接線
		}, false, bt);
		// resize buttons -- (2023.06.07 add)
		var x = radius*Math.cos(theata);
		var y = radius*Math.sin(theata);
		var bt = new lime.Circle().setSize(size, size)
								.setStroke(1)
								//.setFill(cs.graph.colors[i])
								.setPosition(x, y);
		popupMenu.appendChild(bt);
		var label = new lime.Label().setText('-').setFontSize(size*1.25)
									.setFontColor('#ff0000')
									.setFontWeight(700)
									.setPosition(0, -5);
		bt.appendChild(label);
		theata += dA;
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			//var scale = obj.getScale().x;
			//scale -= 0.1;
			//obj.setScale(scale<=0?0.1:scale);
			var oldSize = obj.getSize().clone();
			oldSize.width *= 0.9;
			oldSize.height *= 0.9;
			if(oldSize.width<24) {
				oldSize.width = 24;
			}
			if(oldSize.height<24) {
				oldSize.height = 24;
			}
			obj.setSize(oldSize);
			if(typeof(obj.inner)!='undefined' && obj.inner!=null) {
				//更新內圈的大小
				obj.inner.setSize(oldSize.width*0.85, oldSize.height*0.85);
			}			
			cs.graph.updateConnectedNodesLine(obj); //更新連接線
		}, false, bt);
	}
	// color picker
	var cTotal = ( cs.graph.colors.length < 7 ? cs.graph.colors.length : 7);
	for( var i=0; i<cTotal; i++) {
		var x = radius*Math.cos(theata);
		var y = radius*Math.sin(theata);
		var bt = new lime.Circle().setSize(size, size)
    							.setStroke(1)
    							.setFill(cs.graph.colors[i])
    							.setPosition(x, y);
		theata += dA;
		
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			obj.setFill(this.getFill());
			//close popup menu
			cs.graph.removeThis(this);
		}, false, bt);
		
		popupMenu.appendChild(bt);
	}
	
	// penIcon	
	x = radius*Math.cos(theata);
	y = radius*Math.sin(theata);
	var bt = new lime.Sprite()
						.setFill(cs.graph.penIcon)
						.setSize(size*0.85, size*0.85)
						.setPosition(x, y);
	popupMenu.appendChild(bt);
	theata += dA;
	goog.events.listen(bt,['mousedown','touchstart'],function(e){
		//close popup menu
		//cs.graph.removeThis(this);
		//get input text and update label content
		cs.graph.getLabelText(obj);
	}, false, bt);

	
	//eraserIcon
	x = radius*Math.cos(theata);
	y = radius*Math.sin(theata);
	var bt = new lime.Sprite()
						.setFill(cs.graph.eraserIcon)
						.setSize(size*0.85, size*0.85)
						.setPosition(x, y);
	popupMenu.appendChild(bt);
	theata += dA;
	goog.events.listen(bt,['mousedown','touchstart'],function(e){
		if( typeof(obj.isLineSprite) != 'undefined' ) {
			cs.graph.deleteObject(obj, obj.isLineSprite);
		} else {
			cs.graph.deleteObject(obj);
		}
		//close popup menu
		cs.graph.removeThis(this);
	}, false, bt);

	//close X label
	x = radius*Math.cos(theata);
	y = radius*Math.sin(theata);
	var bt = new lime.Label().setText('X')
						//.setFill('#ffff00')
						.setFontSize(size*.9)
						.setFontColor('#ff0000')
						//.setStroke(1)
						.setSize(size, size)
						.setPosition(x, y);
	popupMenu.appendChild(bt);
	theata += dA;
	goog.events.listen(bt,['mousedown','touchstart'],function(e){
		//close popup menu
		cs.graph.removeThis(this);
	}, false, bt);

	// shape type
	var typeBg = new lime.RoundedRect().setRadius(20)
										.setFill('#F6CECEbf')
										.setSize(cs.graph.defaultNodeObjectSize*1.5, cs.graph.defaultNodeObjectSize)
										//.setStroke(1)
										.setPosition(0,0);
	popupMenu.appendChild(typeBg);
	//如果是連線就顯示箭頭與直線的按鈕, 否則顯示單圈和雙圈的選項
	if( typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite ) {
		// shape type : single line
		x = size/-2*1.2;
		y = 0;
		var bt = new lime.Sprite().setSize(size, size)
							.setFill(cs.graph.lineIcon)
							//.setStroke(1,'#8A2908')
							.setPosition(x, y);
		popupMenu.appendChild(bt);
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			obj.shapeType = 'line';
			//cs.graph.setLineSizeAndRotation( obj.connect[0], obj, obj.connect[1].getPosition(), true );
			cs.graph.setLineSizeAndRotation( obj.connect[0], obj, obj.connect[1], true );
			//close popup menu
			cs.graph.removeThis(this);
		}, false, bt);
		
		// shape type : double circle
		x = size/2*1.2;
		y = 0;
		var bt = new lime.Sprite().setSize(size, size)
							.setFill(cs.graph.arrowIcon)
							//.setStroke(1,'#8A2908')
							.setPosition(x, y);
		popupMenu.appendChild(bt);
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			if(typeof(obj.shapeType)!='undefined' && obj.shapeType!=null && obj.shapeType == 'arrow') {
				//原本就是箭頭的，換箭頭的方向(2023.06.08 add)
				cs.graph.swapLineEndpoints(obj);
			} else {
				obj.shapeType = 'arraow';
				cs.graph.setLineSizeAndRotation( obj.connect[0], obj, obj.connect[1], true );
			}
			//close popup menu
			cs.graph.removeThis(this);
		}, false, bt);	
	} else {
		// shape type : single circle
		x = size/-2*1.2;
		y = 0;
		var bt = new lime.Circle().setSize(size, size)
							.setFill('#ffffff')
							.setStroke(2,'#ff0000')
							.setPosition(x, y);
		popupMenu.appendChild(bt);
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			obj.inner.setHidden(1);
			//close popup menu
			cs.graph.removeThis(this);
		}, false, bt);
		
		// shape type : double circle
		x = size/2*1.2;
		y = 0;
		var bt = new lime.Circle().setSize(size, size)
							.setFill('#ffffff')
							.setStroke(2,'#ff0000')
							.setPosition(x, y);
		popupMenu.appendChild(bt);
		var inner = new lime.Circle().setSize(size*0.8, size*0.8)
							//.setFill('#ffff00')
							.setStroke(1)
							.setPosition(0, 0);
		bt.appendChild(inner);
		goog.events.listen(bt,['mousedown','touchstart'],function(e){
			obj.inner.setHidden(0);
			//close popup menu
			cs.graph.removeThis(this);
		}, false, bt);
	}
	//調整 Popup Menu 的位置
	var pos = obj.getPosition();
	var x = pos.x;
	//var y = pos.y-20;
	var y = pos.y;
	//如果是連線就調至的中間
	if( typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite ) {
		var pos1 = obj.connect[0].getPosition();
		var pos2 = obj.connect[1].getPosition();
		var dx = pos2.x - pos1.x;		
		var dy = pos2.y - pos1.y;
		var width = Math.sqrt( dx * dx + dy * dy );
		//計算角度
		var angel = Math.atan( dy / dx );	
		if( dx < 0 ) {
			angel += Math.PI;
		}			
		//計算兩個節點中間的座標
		x = pos1.x+width/2*Math.cos(angel);
		y = pos1.y+width/2*Math.sin(angel);
	}
	
	//檢查座標是否太旁邊, 是就修正
	var halfSize = bg.getSize().width/2+10;
	if( x < halfSize ) {
		x = halfSize;
	} else if( pos.x > cs.graph.Width-halfSize ) {
		x = cs.graph.Width-halfSize;
	}
	if( y < halfSize ) {
		y = halfSize;
	} else if( pos.y > cs.graph.Height-halfSize ) {
		y = cs.graph.Height-halfSize;
	}

	popupMenu.setPosition(x, y);
	
	topLayer.appendChild(popupMenu);

}
//-------------------------------------------------
// remove one object and all children
//-------------------------------------------------
cs.graph.removeThis = function(obj) {
	var p = obj.getParent();
	var t = p.getParent();
	cs.graph.clearAllChildren(p);
	t.removeChild(p);	
	cs.graph.enableClickTimer(100);
}
//-------------------------------------------------
// 待候一下下再讓其它物件可以被按, 以免誤觸
//-------------------------------------------------
cs.graph.enableClickTimer = function(tNum) {
	if( typeof(tNum) == 'undefined' ) {
		tNum = 100;
	}
	lime.scheduleManager.callAfter( function() {
		cs.graph.clickEnabled = true;
	}, topLayer, tNum);
}
//-------------------------------------------------
// create or edit label of node or line
//-------------------------------------------------
cs.graph.getLabelText = function(obj) {
	cs.graph.clearAllChildren(topLayer);
	cs.graph.clickEnabled = false;	
							
	var txt = '';
	var labelColor = '';
	if( typeof(obj.label) != 'undefined' ) {
		txt = obj.label.getText();
		labelColor = obj.label.getFontColor();
	}
	var dialog = new lime.RoundedRect().setRadius(40)
							.setSize(612, 418)
							.setFill(0x66, 0x99, 0xcc, .85)
							.setStroke(5,'#cccc66')
							.setPosition(cs.graph.Width/2, cs.graph.Height/2-100)
							.setOpacity(1);
	topLayer.appendChild(dialog);

	var width = dialog.getSize().width*0.9;
	var inputText = new game.Input().setFontSize(40)
								.setSize(width, 80)
								.setPosition(0,-40);
	dialog.appendChild(inputText);
	dialog.caption = new lime.Label().setText('標籤文字設定')
									.setFontSize(32)
									.setFontColor('00cc66')
									.setSize(width,40) 
									.setFill('#ffffcc')
									.setStroke(1)
									.setPosition(0, -100);
	dialog.appendChild(dialog.caption);
	dialog.ok = new game.Button().setSize(200,40)
								.setFontColor('#660000')
								.setColor('#ffff00')
								.setFontSize(30)
								.setText('OK')
								.setPosition(0, 150);
	dialog.appendChild(dialog.ok);
	goog.events.listen(dialog.ok,['mousedown','touchstart'],function(e){
		checkValues();
	});

	// color picker
	var size = 42;
	var total = ( cs.graph.colors.length > 10 ? 10 : cs.graph.colors.length );
	var width = dialog.getSize().width;
	var x0 = 0-(size+10)*(total-1)/2;
	var y0 = 50;
	//目前選取的顏色游標
	var colorCursor = new lime.RoundedRect().setRadius(10)
										.setSize(size+10, size+10)
										.setStroke(3)
										.setPosition(x0, y0);
	//顏色選擇清單
	for(var i=0; i<total; i++) {
		var colorSprite = new lime.RoundedRect().setRadius(10).setSize(size, size)
							.setFill(cs.graph.colors[i])
							.setStroke(1,'#989898')
							.setOpacity(1)
							.setPosition(x0+(size+10)*i, y0);
		dialog.appendChild(colorSprite);
		goog.events.listen(colorSprite, ['mousedown','touchstart'],function(e){
			labelColor = 'rgba('+this.getFill().getRgba().toString()+')';
			colorCursor.setPosition(this.getPosition());
			colorCursor.setStroke(3, labelColor);
			inputText.getInputText().style.color = labelColor;
			inputText.input.focus();
		},false,colorSprite);	
		
		if( labelColor != '' ) {
			var c = 'rgba('+colorSprite.getFill().getRgba().toString()+')';
			if( c == labelColor ) {
				colorCursor.setPosition(colorSprite.getPosition());
				colorCursor.setStroke(3, labelColor);
			}
		}
	}
	if( labelColor == '' ) {
		labelColor = 'rgba('+colorSprite.getFill().getRgba().toString()+')';
		colorCursor.setPosition(colorSprite.getPosition());
		colorCursor.setStroke(3, labelColor);
	}
	dialog.appendChild(colorCursor);

	//inputText.getInputText().maxLength = 5;
	inputText.getInputText().placeholder = "按這裡輸入文字";
	inputText.getInputText().value = txt;
	inputText.getInputText().style.color = labelColor;
	//如果是節點, 就將輸入區的背景換成它的顏色
	if( ! ( typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite ) ) {
		inputText.getInputText().style.backgroundColor = 'rgba('+obj.getFill().getRgba().toString()+')';
	}

	//加入鍵盤監聽, 處理 Enter 鍵	
	goog.events.listen(document, ['keyup'], inputKeyupHandler=function(e) {
		if(e.keyCode == 13) {	
			checkValues();
		}
	});
	var checkValues = function() {
		try {
			goog.events.unlisten(document, ['keyup'], inputKeyupHandler);
		} catch(e) { };
		
		var fontsize = 80;
		var labelsize = cs.graph.defaultNodeObjectSize*.8;
		if( typeof(obj.label) != 'undefined' ) {
			obj.label.setFontColor(labelColor);
		} else {
			obj.label = new lime.Label().setText('')
										//.setSize(labelsize, labelsize)
										//.setStroke(1)
										.setFontSize(fontsize)
										.setFontColor(labelColor)
										//.setPosition(0, 0);
			obj.appendChild(obj.label);
		}
		if( typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite ) {
			//
		} else {
			//如果是節點就設定 label 大小,方便計算有多少行
			obj.label.setSize(labelsize, labelsize)
		}
		var txt = inputText.getInputText().value;
		if( txt != null) {
			if( txt.length > 0 && txt != '' && txt.substr(-1,1) != ' ' ) {
				//txt += ' ';
			}
			obj.label.setText(txt);  //.setFontColor(textSprite.label.getFontColor());
		}						
		
		//cs.graph.calcWordsArray(txt);
						
		//慢慢調小字型, 直到總高度沒超過為止
		var newSize = fontsize;
		var lineTotal = 1;
		do {
			var m = obj.label.measureText();
			lineTotal = Math.ceil( m.width / ( labelsize * .8 ) );
			if( newSize * obj.label.getLineHeight() * lineTotal > labelsize*.9) {
				newSize -= 2;
				obj.label.setFontSize(newSize);
			} else {
				break;
			}
		} while( newSize > 8);
		//lineTotal = Math.ceil( obj.label.measureText().width / ( labelsize * .8 ) );
		lineTotal = cs.graph.getLabelLinesNumber(obj.label);
		//console.log(txt + ' : ' + lineTotal);
		obj.label.lineTotal = lineTotal; //記錄下來備用
		//var textHeight = newSize * lineTotal * obj.label.getLineHeight();
		var textHeight = (newSize+obj.label.getLineHeight())*lineTotal-obj.label.getLineHeight();
		//如果是連線就調整水平置中，否則調整垂直置中
		if( typeof(obj.isLineSprite) != 'undefined' && obj.isLineSprite ) {
			var a = obj.getRotation();
			if(a>90 && a<270) {
				//線的旋轉角如果是 90~270 度內時，將字作鏡像，以免變顛倒字, 
				//位置亦要微一下, 以免靠線太近
				//2023.06.07 bug fix
				obj.label.setScale(-1).setPosition(obj.getSize().width/2, -15-obj.label.getFontSize()/2);
			} else {
				obj.label.setScale(1).setPosition(obj.getSize().width/2, -5-obj.label.getFontSize()/2);
			}
		} else {
			obj.label.setPosition(0,(labelsize-textHeight)/2);
		}
		cs.graph.clearAllChildren(dialog);
		cs.graph.clearAllChildren(topLayer);
		cs.graph.enableClickTimer(100);
	};
	
	//讓游標在輸入區
	lime.scheduleManager.callAfter( function() {
		inputText.input.focus();
		//var len = inputText.input.value.length;
		//inputText.input.setSelectionRange(len,len);
	}, inputText, 100);
			
}
//-------------------------------------------------
// 增強版斷字, 將中文(非英數字母者)英文分開
//-------------------------------------------------
cs.graph.calcWordsArray = function(text) {
	var words = [];
  	var len = text.length;
  	var regexp = goog.userAgent.GECKO ? /[\s\.]+/g : /[\s-\.]+/g;
  	var breaks = text.match(regexp);
  	var st = 0;
  	if (breaks)
  	for (var i = 0; i < breaks.length; i++) {
	  	var b = breaks[i];
      	var ibreak = text.indexOf(b, st);
      	var wlen = ibreak + b.length;
	  
	  	words.push(text.substring(st, wlen));	  
      	st = wlen;
  	}
  	if (st != len) {
      	words.push(text.substring(st, len));
  	}
  	
  	var result = [];
  	var regexp2 = /[a-z0-9\s-\.]+/gi;
  	for(var w = 0; w<words.length; w++) {
		var en_text = words[w];
	  	var en_len = en_text.length;
	  	var en_words = en_text.match(regexp2);
	  	var en_st = 0;
  		var breaks = en_text.match(regexp);
  		if(breaks)
  		var b = breaks[0];
	  	if( en_words )
	  	for(var j=0; j< en_words.length; j++) {
	    	var en = en_words[j];
			var enIndex = en_text.indexOf(en, en_st);
			var en_wlen = enIndex + en.length;
			if( enIndex > 0 ) {
				if( en == b ) {
					result.push(en_text.substring(en_st, en_wlen));
				} else {
					result.push(en_text.substring(en_st, enIndex));
				}
			}
			if( en != b ) {
				result.push(en);
			}
			en_st = en_wlen;
	  	}	  	  
	  	if (en_st != en_len) {
			console.log("2 '" + en_words + ':'+en_text.substring(en_st, en_len)+"'");
			result.push(en_text.substring(en_st, en_len));
      	}  	
  	} 
  	console.log(text);
  	console.log(words);
  	console.log(result);
}
//-------------------------------------------------
//
//-------------------------------------------------
cs.graph.getLabelLinesNumber = function(label) {
	var txt = label.getText();
	var pos = label.getPosition();
	var fontsize = label.getFontSize();	
	// wrap the long text
	var maxWidth = label.getSize().width;
	var lineHeight = label.getLineHeight()+fontsize;
	var lines = [];
	var line = '';
	var dy = 0;
	//console.log(txt);
	var tempLabel = new lime.Label().setFontSize(fontsize);
	for(var n = 0; n < txt.length; n++) {
		var word = txt.substr(n,1);
		//-------------------------------
		//斷字處理
		//檢查如果是英文數字, 
		//就抓下一個字, 一直抓到非英數才停
		//-------------------------------
		var k = 1;
		var nextOne = word;
		while( (n+k-1) < txt.length && /^[a-z0-9]+$/i.test(nextOne) ) {
			nextOne = txt.substr(n+k,1);					
			if( /^[a-z0-9]+$/i.test(nextOne) ) {						
				word +=  nextOne;
				k++;
			} else {
				break;
			}
		}
		n += (k-1);
		//-------------------------------
		//斷字處理結束
		//-------------------------------
		var testLine = line + word;
		//var metrics = ctx.measureText(testLine);
		var metrics = tempLabel.setText(testLine).measureText();
		var testWidth = metrics.width;
		if (testWidth >= maxWidth && n > 0) {
			//ctx.fillText(line, x+pos.x, y-pos.y+dy);
			lines.push(line);
			line = word;
			dy += lineHeight
		} 
		else {
			line = testLine;
		}
	}
	lines.push(line);
	//draw all lines
	//dy = fontsize/2 - lineHeight*(lines.length-1)/2-label.getLineHeight();
	//for(var n=0; n<lines.length; n++) {
	//	ctx.fillText(lines[n], x+pos.x, y+dy+lineHeight*n);
	//}
	return lines.length;
}
//-------------------------------------------------
// update position or rotation of line
//-------------------------------------------------
cs.graph.setLineSizeAndRotation = function(source, line, targetOrPos2, isRelease) {
	var pos1 = source.getPosition();	//第一個節點的座標
	var pos2; //第二個節點的座標
	if(typeof(targetOrPos2.getPosition)=='function') {
		pos2 = targetOrPos2.getPosition();
	} else {
		pos2 = targetOrPos2;
	}
	//計算距離(斜邊長)
	var xOffset = pos2.x - pos1.x;		
	var yOffset = pos2.y - pos1.y;
	var width = Math.sqrt( xOffset * xOffset + yOffset * yOffset );
	//計算角度
	var angel = Math.atan( yOffset / xOffset ) * 180 / Math.PI ;	
	if( xOffset < 0 ) {
		angel += 180;
	}		
	
	//計算圓周上的座標(往內縮 2)
	var diameter = source.getSize().width-2;
	var x = pos1.x+diameter/2*Math.cos(angel/180*Math.PI);
	var y = pos1.y+diameter/2*Math.sin(angel/180*Math.PI);
	line.setPosition(x, y);	//將線起點移到第一點的圓周上
	//將線終點移到第二點的圓周上
	if( typeof(isRelease) != 'undefined' && isRelease ) {
		if(typeof(targetOrPos2.getSize)=='function') {
			//滑鼠放開時少第一點的半徑 and 第二點的半徑 (2023.06.07 add)
			width -= diameter/2+(targetOrPos2.getSize().width-2)/2;
		} else {
			//第二點未提供元件大小者, 滑鼠放開時少一個直徑
			width -= diameter;	
		}
	} else {
		width -= diameter/2;	//滑鼠未放開前少一個半徑就好
	}
	
	//如果還在節點圖形內就先隱藏連線
	if( width < diameter/4 ) {
		line.setHidden(1);
		return 1;
	} else {
		line.setHidden(0);
	}
	
	//直線帶箭頭
	var x2 = width*Math.cos(angel/180*Math.PI);
	var y2 = width*Math.sin(angel/180*Math.PI);
	x2 = width;
	var h = cs.graph.defaultLineSize;	//線的粗線
	if( typeof(line.shapeType) != 'undefined' && line.shapeType == 'line' ) {
		//純拉線
		line.setPoints(0,h/-2, x2,h/-2, x2,h/2,  0,h/2);
	} else {
		//加箭頭的
		line.shapeType = 'arrow'; //沒設定, 幫忙加上
		var aWidth = h*4;	//箭頭的寬
		var aHeight = h*3;	//箭頭的高
		var aTail = h*0.5;
		//line.setPoints(0,h/-2, (x2-aWidth+5),h/-2, (x2-aWidth),-1*aHeight/2, x2,0, (x2-aWidth),aHeight/2, (x2-aWidth+5),h/2, 0,h/2);
		line.setPoints(0,h/-2, (x2-aWidth+aTail),h/-2, (x2-aWidth),-1*aHeight/2, x2,0, (x2-aWidth),aHeight/2, (x2-aWidth+aTail),h/2, 0,h/2)	
	}
	line.setRotation(360-angel);
		
	if( typeof(line.label) != 'undefined' ) {
		var a = line.getRotation();
		if(a>90 && a<270) {
			//線的旋轉角如果是 90~270 度內時，將字作鏡像，以免變顛倒字, 
			//位置亦要微一下, 以免靠線太近
			//2023.06.07 bug fix
			line.label.setScale(-1)
						.setPosition(width/2, -15-line.label.getFontSize()/2);	//將字置中
		} else {
			line.label.setScale(1)
						.setPosition(width/2, -5-line.label.getFontSize()/2);	//將字置中
		}
	}
	line.setHidden(0);
}
//-------------------------------------------------
// swap the endpoint objects of a line
//-------------------------------------------------
cs.graph.swapLineEndpoints = function(obj) {
	if(typeof(obj.connect)!='undefined' && obj.connect!=null && obj.connect.length>1) {
		var firstPoint =obj.connect[0];
		obj.connect[0] = obj.connect[1];
		obj.connect[1] = firstPoint;
		cs.graph.updateConnectedNodesLine(firstPoint);
	}
}
//-------------------------------------------------
// delete line or node object and connected lines
//-------------------------------------------------
cs.graph.deleteObject = function(obj, isLineSprite) {
	if( typeof(isLineSprite) == 'undefined' ) {
		isLineSprite=false;
	}
	if( isLineSprite ) {
		for( var i=0; i<obj.connect.length; i++ ) {
			var another = obj.connect[i];
			/*
			for( var j=0; j<another.lines.length; j++ ) {
				if( another.lines[j] == line ) {
					another.lines.splice(j, 1);
					break;
				}
			}
			*/
			cs.graph.clearAllChildren(obj);
			lineLayer.removeChild(obj);
		}
	} else {
		if( typeof(obj.lines) != 'undefined' ) {
			for( var i=0; i<obj.lines.length; i++ ) {
				var line = obj.lines[i];
				if( line.connect[0] == obj ) {
					var another = line.connect[1];
				} else {
					var another = line.connect[0];
				}
				for( var j=0; j<another.lines.length; j++ ) {
					if( another.lines[j] == line ) {
						another.lines.splice(j, 1);
						break;
					}
				}
				cs.graph.clearAllChildren(line);
				lineLayer.removeChild(line);
			}
		}
		cs.graph.clearAllChildren(obj);
		objLayer.removeChild(obj);
	}
}

//-------------------------------------------------
//
//-------------------------------------------------
cs.graph.clearAllChildEvents = function(target) {
	try {
		var t = target.getNumberOfChildren();
		for(var i=0; i<t; i++) {
			goog.events.removeAll(target.getChildAt(i));
		}
	} catch(e) {};
}
//-------------------------------------------------
//
//-------------------------------------------------
cs.graph.clearAllChildren = function(target) {
	cs.graph.clearAllChildEvents(target);
	for(var i=0; i<target.getNumberOfChildren(); i++) {
		var child = target.getChildAt(i);
		try {
			lime.animation.actionManager.stopAll(child);
		} catch(e) {	};
		try {
			cs.graph.clearAllChildEvents(child);
		} catch(e) {	};
		try {
			child.removeAllChildren();
		} catch(e) {	};
		try {
			target.removeChild(child);
		} catch(e) {	};
	}
	try {
		target.removeAllChildren();
	} catch(e) {	};
}

//this is required for outside access after code is compiled in ADVANCED_COMPILATIONS mode
goog.exportSymbol('cs.graph.start', cs.graph.start);
